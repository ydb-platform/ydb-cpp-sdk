name: Build
description: Build YDB SDK

inputs:
  compiler:
    description: 'Compiler to use (clang or gcc)'
    required: true
    default: 'clang'

runs:
  using: "composite"
  steps:
    - name: Configure
      shell: bash
      run: |
        mkdir -p ../build${{ inputs.compiler == 'gcc' && '-gcc' || '' }}
        rm -rf ../build${{ inputs.compiler == 'gcc' && '-gcc' || '' }}/*
        cmake --preset release-test-with-ccache-basedir${{ inputs.compiler == 'gcc' && '-gcc' || '' }}
    - name: Build
      shell: bash
      run: |
        ccache -z
        export CCACHE_BASEDIR=`realpath ..`
        export CCACHE_DIR=~/.ccache
        cmake --build --preset release${{ inputs.compiler == 'gcc' && '-gcc' || '' }} -- -j32
        ccache -s
